<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="A Metric object encapsulates metric logic and state that can be used to
track model performance during training. It is what is returned by the family
of metric functions that start with prefix metric_*, as well as what is
returned by custom metrics defined with Metric()."><title>Subclass the base Metric class — Metric • keras3</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Subclass the base Metric class — Metric"><meta property="og:description" content="A Metric object encapsulates metric logic and state that can be used to
track model performance during training. It is what is returned by the family
of metric functions that start with prefix metric_*, as well as what is
returned by custom metrics defined with Metric()."><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-inverse navbar-expand-lg bg-primary" data-bs-theme="inverse"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">keras3</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/getting_started.html">Getting Started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-guides">Guides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-guides">
    <h6 class="dropdown-header" data-toc-skip>Model definition</h6>
    <a class="dropdown-item" href="../articles/sequential_model.html">Sequential Model</a>
    <a class="dropdown-item" href="../articles/functional_api.html">Functional API</a>
    <h6 class="dropdown-header" data-toc-skip>Extending and customizing</h6>
    <a class="dropdown-item" href="../articles/training_with_built_in_methods.html">Training &amp; evaluation with the built-in methods</a>
    <a class="dropdown-item" href="../articles/custom_train_step_in_tensorflow.html">Customizing `fit()` with Tensorflow</a>
    <a class="dropdown-item" href="../articles/writing_your_own_callbacks.html">Writing your own callbacks</a>
    <a class="dropdown-item" href="../articles/making_new_layers_and_models_via_subclassing.html">Making new layers and models via subclassing</a>
    <a class="dropdown-item" href="../articles/writing_a_custom_training_loop_in_tensorflow.html">Writing a training loop from scratch in TensorFlow</a>
    <a class="dropdown-item" href="../articles/serialization_and_saving.html">Serialization and Saving</a>
    <h6 class="dropdown-header" data-toc-skip>Other topics</h6>
    <a class="dropdown-item" href="../articles/transfer_learning.html">Transfer learning and fine tuning</a>
    <a class="dropdown-item" href="../articles/distributed_training_with_tensorflow.html">Distributed training with TensorFlow</a>
    <a class="dropdown-item" href="../articles/distribution.html">Distributed training with Jax</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/examples/index.html">Examples</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rstudio/keras3/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Subclass the base <code>Metric</code> class</h1>
      <small class="dont-index">Source: <a href="https://github.com/rstudio/keras3/blob/HEAD/R/Metric.R" class="external-link"><code>R/Metric.R</code></a></small>
      <div class="d-none name"><code>Metric.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A <code>Metric</code> object encapsulates metric logic and state that can be used to
track model performance during training. It is what is returned by the family
of metric functions that start with prefix <code>metric_*</code>, as well as what is
returned by custom metrics defined with <code>Metric()</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Metric</span><span class="op">(</span></span>
<span>  <span class="va">classname</span>,</span>
<span>  initialize <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  update_state <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  result <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  inherit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parent_env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>classname</dt>
<dd><p>String, the name of the custom class. (Conventionally, CamelCase).</p></dd>


<dt>initialize, update_state, result</dt>
<dd><p>Recommended methods to implement. See description section.</p></dd>


<dt>..., public</dt>
<dd><p>Additional methods or public members of the custom class.</p></dd>


<dt>private</dt>
<dd><p>Named list of R objects (typically, functions) to include in
instance private environments. <code>private</code> methods will have all the same
symbols in scope as public methods (See section "Symbols in Scope"). Each
instance will have it's own <code>private</code> environment. Any objects
in <code>private</code> will be invisible from the Keras framework and the Python
runtime.</p></dd>


<dt>inherit</dt>
<dd><p>What the custom class will subclass. By default, the base keras class.</p></dd>


<dt>parent_env</dt>
<dd><p>The R environment that all class methods will have as a grandparent.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A function that returns <code>Metric</code> instances, similar to the
builtin metric functions.</p>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>
    
<div class="section">
<h3 id="usage-with-compile-">Usage with <code><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile()</a></code>:<a class="anchor" aria-label="anchor" href="#usage-with-compile-"></a></h3>


<p></p><div class="sourceCode r"><pre><code><span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span></span>
<span>  optimizer <span class="op">=</span> <span class="st">'sgd'</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">'mse'</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">metric_SOME_METRIC</span><span class="op">(</span><span class="op">)</span>, <span class="fu">metric_SOME_OTHER_METRIC</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="standalone-usage-">Standalone usage:<a class="anchor" aria-label="anchor" href="#standalone-usage-"></a></h3>


<p></p><div class="sourceCode r"><pre><code><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">metric_SOME_METRIC</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">epochs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">train_steps</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">y_true</span>, <span class="va">y_pred</span>, sample_weight <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op"><a href="../reference/multi-assign.html">%&lt;-%</a></span> <span class="va">...</span></span>
<span>    <span class="va">m</span><span class="op">$</span><span class="fu">update_state</span><span class="op">(</span><span class="va">y_true</span>, <span class="va">y_pred</span>, <span class="va">sample_weight</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'Final epoch result: '</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="fu">result</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">m</span><span class="op">$</span><span class="fu">reset_state</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre><p></p></div>
</div>

    </div>
    <div class="section level2">
    <h2 id="full-examples">Full Examples<a class="anchor" aria-label="anchor" href="#full-examples"></a></h2>
    
<div class="section">
<h3 id="usage-with-compile--1">Usage with <code><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile()</a></code>:<a class="anchor" aria-label="anchor" href="#usage-with-compile--1"></a></h3>


<p></p><div class="sourceCode r"><pre><code><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/keras_model_sequential.html">keras_model_sequential</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">64</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">64</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">10</span>, activation <span class="op">=</span> <span class="st">"softmax"</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span>optimizer <span class="op">=</span> <span class="fu"><a href="../reference/optimizer_rmsprop.html">optimizer_rmsprop</a></span><span class="op">(</span><span class="fl">0.01</span><span class="op">)</span>,</span>
<span>          loss <span class="op">=</span> <span class="fu"><a href="../reference/loss_categorical_crossentropy.html">loss_categorical_crossentropy</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          metrics <span class="op">=</span> <span class="fu"><a href="../reference/metric_categorical_accuracy.html">metric_categorical_accuracy</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/random_uniform.html">random_uniform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">32</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/random_uniform.html">random_uniform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">labels</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre><p></p></div>
<p>To be implemented by subclasses (custom metrics):</p><ul><li><p><code>initialize()</code>: All state variables should be created in this method by
calling <code>self$add_variable()</code> like: <code>self$var &lt;- self$add_variable(...)</code>.</p></li>
<li><p><code>update_state()</code>: Updates all the state variables like:
<code>self$var$assign(...)</code>.</p></li>
<li><p><code>result()</code>: Computes and returns a scalar value or a named list of scalar values
for the metric from the state variables.</p></li>
</ul><p>Example subclass implementation:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">metric_binary_true_positives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Metric.html">Metric</a></span><span class="op">(</span></span>
<span>  classname <span class="op">=</span> <span class="st">"BinaryTruePositives"</span>,</span>
<span></span>
<span>  initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">name</span> <span class="op">=</span> <span class="st">'binary_true_positives'</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">super</span><span class="op">$</span><span class="fu">initialize</span><span class="op">(</span>name <span class="op">=</span> <span class="va">name</span>, <span class="va">...</span><span class="op">)</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">true_positives</span> <span class="op">&lt;-</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="fu">add_weight</span><span class="op">(</span>shape <span class="op">=</span> <span class="fu"><a href="../reference/shape.html">shape</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      initializer <span class="op">=</span> <span class="st">'zeros'</span>,</span>
<span>                      name <span class="op">=</span> <span class="st">'true_positives'</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  update_state <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">y_true</span>, <span class="va">y_pred</span>, <span class="va">sample_weight</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">y_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/op_cast.html">op_cast</a></span><span class="op">(</span><span class="va">y_true</span>, <span class="st">"bool"</span><span class="op">)</span></span>
<span>    <span class="va">y_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/op_cast.html">op_cast</a></span><span class="op">(</span><span class="va">y_pred</span>, <span class="st">"bool"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">values</span> <span class="op">&lt;-</span> <span class="va">y_true</span> <span class="op">&amp;</span> <span class="va">y_pred</span> <span class="co"># `&amp;` calls op_logical_and()</span></span>
<span>    <span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/op_cast.html">op_cast</a></span><span class="op">(</span><span class="va">values</span>, <span class="va">self</span><span class="op">$</span><span class="va">dtype</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">sample_weight</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">sample_weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/op_cast.html">op_cast</a></span><span class="op">(</span><span class="va">sample_weight</span>, <span class="va">self</span><span class="op">$</span><span class="va">dtype</span><span class="op">)</span></span>
<span>      <span class="va">sample_weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/op_broadcast_to.html">op_broadcast_to</a></span><span class="op">(</span><span class="va">sample_weight</span>, <span class="fu"><a href="../reference/shape.html">shape</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">values</span> <span class="op">&lt;-</span> <span class="va">values</span> <span class="op">*</span> <span class="va">sample_weight</span> <span class="co"># `*` calls op_multiply()</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">true_positives</span><span class="op">$</span><span class="fu">assign</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">true_positives</span> <span class="op">+</span> <span class="fu"><a href="../reference/op_sum.html">op_sum</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  result <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">true_positives</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/keras_model_sequential.html">keras_model_sequential</a></span><span class="op">(</span>input_shape <span class="op">=</span> <span class="fl">32</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span>loss <span class="op">=</span> <span class="fu"><a href="../reference/loss_binary_crossentropy.html">loss_binary_crossentropy</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                 metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">metric_binary_true_positives</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">labels</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

    </div>
    <div class="section level2">
    <h2 id="methods-defined-by-the-base-metric-class-">Methods defined by the base <code>Metric</code> class:<a class="anchor" aria-label="anchor" href="#methods-defined-by-the-base-metric-class-"></a></h2>
    
<ul><li><p></p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">__call__</span>(...)</span></code></pre><p></p></div>
<p>Calling a metric instance self like <code>m(...)</code> is equivalent to calling:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m</span><span class="op">$</span><span class="fu">update_state</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">m</span><span class="op">$</span><span class="fu">result</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre><p></p></div></li>
<li><p></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">initialize</span><span class="op">(</span>dtype<span class="op">=</span><span class="cn">NULL</span>, name<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Initialize self.</p>
<p>Args:</p><ul><li><p><code>name</code>: (Optional) string name of the metric instance.</p></li>
<li><p><code>dtype</code>: (Optional) data type of the metric result.</p></li>
</ul></li>
<li><p></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">add_variable</span><span class="op">(</span><span class="va">shape</span>, <span class="va">initializer</span>, dtype<span class="op">=</span><span class="cn">NULL</span>, aggregation <span class="op">=</span> <span class="st">'sum'</span>, name<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre><p></p></div></li>
<li><p></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">add_weight</span><span class="op">(</span>shape<span class="op">=</span><span class="fu"><a href="../reference/shape.html">shape</a></span><span class="op">(</span><span class="op">)</span>, initializer<span class="op">=</span><span class="cn">NULL</span>, dtype<span class="op">=</span><span class="cn">NULL</span>, name<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre><p></p></div></li>
<li><p></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/get_config.html">get_config</a></span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Return the serializable config of the metric.</p></li>
<li><p></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/reset_state.html">reset_state</a></span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Reset all of the metric state variables.</p>
<p>This function is called between epochs/steps,
when a metric is evaluated during training.</p></li>
<li><p></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">result</span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Compute the current metric value.</p>
<p>Returns:
A scalar tensor, or a named list of scalar tensors.</p></li>
<li><p></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">stateless_result</span><span class="op">(</span><span class="va">metric_variables</span><span class="op">)</span></span></code></pre><p></p></div></li>
<li><p></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">stateless_reset_state</span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div></li>
<li><p></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">stateless_update_state</span><span class="op">(</span><span class="va">metric_variables</span>, <span class="va">...</span><span class="op">)</span></span></code></pre><p></p></div></li>
<li><p></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">update_state</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Accumulate statistics for the metric.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="readonly-properties">Readonly properties<a class="anchor" aria-label="anchor" href="#readonly-properties"></a></h2>
    
<ul><li><p><code>dtype</code></p></li>
<li><p><code>variables</code></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="symbols-in-scope">Symbols in scope<a class="anchor" aria-label="anchor" href="#symbols-in-scope"></a></h2>
    <p>All R function custom methods (public and private) will have the
following symbols in scope:</p><ul><li><p><code>self</code>: The custom class instance.</p></li>
<li><p><code>super</code>: The custom class superclass.</p></li>
<li><p><code>private</code>: An R environment specific to the class instance.
Any objects assigned here are invisible to the Keras framework.</p></li>
<li><p><code>__class__</code> and <code>as.symbol(classname)</code>: the custom class type object.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other metrics: <br><code><a href="custom_metric.html">custom_metric</a>()</code> <br><code><a href="metric_auc.html">metric_auc</a>()</code> <br><code><a href="metric_binary_accuracy.html">metric_binary_accuracy</a>()</code> <br><code><a href="metric_binary_crossentropy.html">metric_binary_crossentropy</a>()</code> <br><code><a href="metric_binary_focal_crossentropy.html">metric_binary_focal_crossentropy</a>()</code> <br><code><a href="metric_binary_iou.html">metric_binary_iou</a>()</code> <br><code><a href="metric_categorical_accuracy.html">metric_categorical_accuracy</a>()</code> <br><code><a href="metric_categorical_crossentropy.html">metric_categorical_crossentropy</a>()</code> <br><code><a href="metric_categorical_focal_crossentropy.html">metric_categorical_focal_crossentropy</a>()</code> <br><code><a href="metric_categorical_hinge.html">metric_categorical_hinge</a>()</code> <br><code><a href="metric_cosine_similarity.html">metric_cosine_similarity</a>()</code> <br><code><a href="metric_f1_score.html">metric_f1_score</a>()</code> <br><code><a href="metric_false_negatives.html">metric_false_negatives</a>()</code> <br><code><a href="metric_false_positives.html">metric_false_positives</a>()</code> <br><code><a href="metric_fbeta_score.html">metric_fbeta_score</a>()</code> <br><code><a href="metric_hinge.html">metric_hinge</a>()</code> <br><code><a href="metric_huber.html">metric_huber</a>()</code> <br><code><a href="metric_iou.html">metric_iou</a>()</code> <br><code><a href="metric_kl_divergence.html">metric_kl_divergence</a>()</code> <br><code><a href="metric_log_cosh.html">metric_log_cosh</a>()</code> <br><code><a href="metric_log_cosh_error.html">metric_log_cosh_error</a>()</code> <br><code><a href="metric_mean.html">metric_mean</a>()</code> <br><code><a href="metric_mean_absolute_error.html">metric_mean_absolute_error</a>()</code> <br><code><a href="metric_mean_absolute_percentage_error.html">metric_mean_absolute_percentage_error</a>()</code> <br><code><a href="metric_mean_iou.html">metric_mean_iou</a>()</code> <br><code><a href="metric_mean_squared_error.html">metric_mean_squared_error</a>()</code> <br><code><a href="metric_mean_squared_logarithmic_error.html">metric_mean_squared_logarithmic_error</a>()</code> <br><code><a href="metric_mean_wrapper.html">metric_mean_wrapper</a>()</code> <br><code><a href="metric_one_hot_iou.html">metric_one_hot_iou</a>()</code> <br><code><a href="metric_one_hot_mean_iou.html">metric_one_hot_mean_iou</a>()</code> <br><code><a href="metric_poisson.html">metric_poisson</a>()</code> <br><code><a href="metric_precision.html">metric_precision</a>()</code> <br><code><a href="metric_precision_at_recall.html">metric_precision_at_recall</a>()</code> <br><code><a href="metric_r2_score.html">metric_r2_score</a>()</code> <br><code><a href="metric_recall.html">metric_recall</a>()</code> <br><code><a href="metric_recall_at_precision.html">metric_recall_at_precision</a>()</code> <br><code><a href="metric_root_mean_squared_error.html">metric_root_mean_squared_error</a>()</code> <br><code><a href="metric_sensitivity_at_specificity.html">metric_sensitivity_at_specificity</a>()</code> <br><code><a href="metric_sparse_categorical_accuracy.html">metric_sparse_categorical_accuracy</a>()</code> <br><code><a href="metric_sparse_categorical_crossentropy.html">metric_sparse_categorical_crossentropy</a>()</code> <br><code><a href="metric_sparse_top_k_categorical_accuracy.html">metric_sparse_top_k_categorical_accuracy</a>()</code> <br><code><a href="metric_specificity_at_sensitivity.html">metric_specificity_at_sensitivity</a>()</code> <br><code><a href="metric_squared_hinge.html">metric_squared_hinge</a>()</code> <br><code><a href="metric_sum.html">metric_sum</a>()</code> <br><code><a href="metric_top_k_categorical_accuracy.html">metric_top_k_categorical_accuracy</a>()</code> <br><code><a href="metric_true_negatives.html">metric_true_negatives</a>()</code> <br><code><a href="metric_true_positives.html">metric_true_positives</a>()</code> <br></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tomasz Kalinowski, JJ Allaire, François Chollet, Posit Software, PBC, Google.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

