<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Imbalanced classification: credit card fraud detection • keras3</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../../apple-touch-icon-60x60.png">
<script src="../../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../../deps/search-1.0.0/fuse.min.js"></script><script src="../../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../../pkgdown.js"></script><link href="../../../extra.css" rel="stylesheet">
<meta property="og:title" content="Imbalanced classification: credit card fraud detection">
<meta name="description" content="Demonstration of how to handle highly imbalanced classification problems.">
<meta property="og:description" content="Demonstration of how to handle highly imbalanced classification problems.">
<meta name="robots" content="noindex">
<!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KHBDBW7');</script><!-- End Google Tag Manager -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KHBDBW7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) -->


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../../index.html">keras3</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../../articles/getting_started.html">Getting Started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides">
<li><h6 class="dropdown-header" data-toc-skip>Model definition</h6></li>
    <li><a class="dropdown-item" href="../../../articles/sequential_model.html">Sequential Model</a></li>
    <li><a class="dropdown-item" href="../../../articles/functional_api.html">Functional API</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending and customizing</h6></li>
    <li><a class="dropdown-item" href="../../../articles/training_with_built_in_methods.html">Training &amp; evaluation with the built-in methods</a></li>
    <li><a class="dropdown-item" href="../../../articles/custom_train_step_in_tensorflow.html">Customizing `fit()` with Tensorflow</a></li>
    <li><a class="dropdown-item" href="../../../articles/writing_your_own_callbacks.html">Writing your own callbacks</a></li>
    <li><a class="dropdown-item" href="../../../articles/making_new_layers_and_models_via_subclassing.html">Making new layers and models via subclassing</a></li>
    <li><a class="dropdown-item" href="../../../articles/writing_a_custom_training_loop_in_tensorflow.html">Writing a training loop from scratch in TensorFlow</a></li>
    <li><a class="dropdown-item" href="../../../articles/serialization_and_saving.html">Serialization and Saving</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other topics</h6></li>
    <li><a class="dropdown-item" href="../../../articles/transfer_learning.html">Transfer learning and fine tuning</a></li>
    <li><a class="dropdown-item" href="../../../articles/distributed_training_with_tensorflow.html">Distributed training with TensorFlow</a></li>
    <li><a class="dropdown-item" href="../../../articles/distribution.html">Distributed training with Jax</a></li>
  </ul>
</li>
<li class="active nav-item"><a class="nav-link" href="../../../articles/examples/index.html">Examples</a></li>
<li class="nav-item"><a class="nav-link" href="../../../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../../../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/keras3/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Imbalanced classification: credit card fraud detection</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/keras3/blob/HEAD/vignettes/examples/structured_data/imbalanced_classification.Rmd" class="external-link"><code>vignettes/examples/structured_data/imbalanced_classification.Rmd</code></a></small>
      <div class="d-none name"><code>imbalanced_classification.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keras3.posit.co/">keras3</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../../../reference/use_backend.html">use_backend</a></span><span class="op">(</span><span class="st">"jax"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This example looks at the <a href="https://www.kaggle.com/mlg-ulb/creditcardfraud/" class="external-link">Kaggle Credit
Card Fraud Detection</a> dataset to demonstrate how to train a
classification model on data with highly imbalanced classes. You can
download the data by clicking “Download” at the link, or if you’re setup
with a kaggle API key at <code>"~/.kaggle/kagle.json"</code>, you can
run the following:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_install.html" class="external-link">py_install</a></span><span class="op">(</span><span class="st">"kaggle"</span>, pip <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_available.html" class="external-link">py_available</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># ensure 'kaggle' is on the PATH</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"kaggle datasets download -d mlg-ulb/creditcardfraud"</span><span class="op">)</span></span>
<span><span class="fu">zip</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/zip/reference/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"creditcardfraud.zip"</span>, files <span class="op">=</span> <span class="st">"creditcard.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="first-load-the-data">First, load the data<a class="anchor" aria-label="anchor" href="#first-load-the-data"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"creditcard.csv"</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span></span>
<span>  Class <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .default <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_double</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 284,807</span></span>
<span><span class="co">## Columns: 31</span></span>
<span><span class="co">## $ Time   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0, 0, 1, 1, 2, 2, 4, 7, 7, 9, 10, 10, 10, 11, 12, 12, 12, 1…</span></span>
<span><span class="co">## $ V1     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -1.3598071, 1.1918571, -1.3583541, -0.9662717, -1.1582331, …</span></span>
<span><span class="co">## $ V2     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.07278117, 0.26615071, -1.34016307, -0.18522601, 0.877736…</span></span>
<span><span class="co">## $ V3     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.53634674, 0.16648011, 1.77320934, 1.79299334, 1.54871785,…</span></span>
<span><span class="co">## $ V4     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.37815522, 0.44815408, 0.37977959, -0.86329128, 0.40303393…</span></span>
<span><span class="co">## $ V5     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.33832077, 0.06001765, -0.50319813, -0.01030888, -0.40719…</span></span>
<span><span class="co">## $ V6     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.46238778, -0.08236081, 1.80049938, 1.24720317, 0.09592146…</span></span>
<span><span class="co">## $ V7     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.239598554, -0.078802983, 0.791460956, 0.237608940, 0.5929…</span></span>
<span><span class="co">## $ V8     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.098697901, 0.085101655, 0.247675787, 0.377435875, -0.2705…</span></span>
<span><span class="co">## $ V9     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.3637870, -0.2554251, -1.5146543, -1.3870241, 0.8177393, -…</span></span>
<span><span class="co">## $ V10    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.09079417, -0.16697441, 0.20764287, -0.05495192, 0.7530744…</span></span>
<span><span class="co">## $ V11    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.55159953, 1.61272666, 0.62450146, -0.22648726, -0.822842…</span></span>
<span><span class="co">## $ V12    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.61780086, 1.06523531, 0.06608369, 0.17822823, 0.53819555…</span></span>
<span><span class="co">## $ V13    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.99138985, 0.48909502, 0.71729273, 0.50775687, 1.34585159…</span></span>
<span><span class="co">## $ V14    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.31116935, -0.14377230, -0.16594592, -0.28792375, -1.1196…</span></span>
<span><span class="co">## $ V15    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.468176972, 0.635558093, 2.345864949, -0.631418118, 0.1751…</span></span>
<span><span class="co">## $ V16    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.47040053, 0.46391704, -2.89008319, -1.05964725, -0.45144…</span></span>
<span><span class="co">## $ V17    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.207971242, -0.114804663, 1.109969379, -0.684092786, -0.23…</span></span>
<span><span class="co">## $ V18    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.02579058, -0.18336127, -0.12135931, 1.96577500, -0.038194…</span></span>
<span><span class="co">## $ V19    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.40399296, -0.14578304, -2.26185710, -1.23262197, 0.803486…</span></span>
<span><span class="co">## $ V20    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.25141210, -0.06908314, 0.52497973, -0.20803778, 0.4085423…</span></span>
<span><span class="co">## $ V21    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.018306778, -0.225775248, 0.247998153, -0.108300452, -0.0…</span></span>
<span><span class="co">## $ V22    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.277837576, -0.638671953, 0.771679402, 0.005273597, 0.7982…</span></span>
<span><span class="co">## $ V23    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.110473910, 0.101288021, 0.909412262, -0.190320519, -0.13…</span></span>
<span><span class="co">## $ V24    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.06692807, -0.33984648, -0.68928096, -1.17557533, 0.141266…</span></span>
<span><span class="co">## $ V25    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.12853936, 0.16717040, -0.32764183, 0.64737603, -0.2060095…</span></span>
<span><span class="co">## $ V26    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.18911484, 0.12589453, -0.13909657, -0.22192884, 0.502292…</span></span>
<span><span class="co">## $ V27    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.133558377, -0.008983099, -0.055352794, 0.062722849, 0.219…</span></span>
<span><span class="co">## $ V28    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.021053053, 0.014724169, -0.059751841, 0.061457629, 0.215…</span></span>
<span><span class="co">## $ Amount <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 149.62, 2.69, 378.66, 123.50, 69.99, 3.67, 4.99, 40.80, 93.…</span></span>
<span><span class="co">## $ Class  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="prepare-a-validation-set">Prepare a validation set<a class="anchor" aria-label="anchor" href="#prepare-a-validation-set"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">val_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op"><a href="../../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span> <span class="va">.</span> <span class="op">*</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">val_df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">val_idx</span>, <span class="op">]</span></span>
<span><span class="va">train_df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">-</span><span class="va">val_idx</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of training samples:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Number of training samples: 227846</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of validation samples:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">val_df</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Number of validation samples: 56961</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="analyze-class-imbalance-in-the-targets">Analyze class imbalance in the targets<a class="anchor" aria-label="anchor" href="#analyze-class-imbalance-in-the-targets"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span><span class="va">counts</span></span></code></pre></div>
<pre><code><span><span class="co">##</span></span>
<span><span class="co">##      0      1</span></span>
<span><span class="co">## 227455    391</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Number of positive samples in training data: %i (%.2f%% of total)"</span>,</span>
<span>            <span class="va">counts</span><span class="op">[</span><span class="st">"1"</span><span class="op">]</span>, <span class="fl">100</span> <span class="op">*</span> <span class="va">counts</span><span class="op">[</span><span class="st">"1"</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Number of positive samples in training data: 391 (0.17% of total)</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_for_0</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">counts</span><span class="op">[</span><span class="st">"0"</span><span class="op">]</span></span>
<span><span class="va">weight_for_1</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">counts</span><span class="op">[</span><span class="st">"1"</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="normalize-the-data-using-training-set-statistics">Normalize the data using training set statistics<a class="anchor" aria-label="anchor" href="#normalize-the-data-using-training-set-statistics"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feature_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">)</span> <span class="op"><a href="../../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="st">"Class"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">[</span><span class="va">feature_names</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">train_targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span></span>
<span><span class="va">val_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">val_df</span><span class="op">[</span><span class="va">feature_names</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">val_targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">val_df</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_features</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">val_features</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">train_features</span>, <span class="st">"scaled:center"</span><span class="op">)</span>,</span>
<span>                        scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">train_features</span>, <span class="st">"scaled:scale"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="build-a-binary-classification-model">Build a binary classification model<a class="anchor" aria-label="anchor" href="#build-a-binary-classification-model"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../../../reference/keras_model_sequential.html">keras_model_sequential</a></span><span class="op">(</span>input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">train_features</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">256</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">256</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dropout.html">layer_dropout</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">256</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dropout.html">layer_dropout</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">1</span>, activation <span class="op">=</span> <span class="st">"sigmoid"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Model: "sequential"</span></span></span>
<span><span class="co">## ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓</span></span>
<span><span class="co">## ┃<span style="font-weight: bold;"> Layer (type)                    </span>┃<span style="font-weight: bold;"> Output Shape           </span>┃<span style="font-weight: bold;">       Param # </span>┃</span></span>
<span><span class="co">## ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩</span></span>
<span><span class="co">## │ dense (<span style="color: #0087FF;">Dense</span>)                   │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">256</span>)            │         <span style="color: #00AF00;">7,936</span> │</span></span>
<span><span class="co">## ├─────────────────────────────────┼────────────────────────┼───────────────┤</span></span>
<span><span class="co">## │ dense_1 (<span style="color: #0087FF;">Dense</span>)                 │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">256</span>)            │        <span style="color: #00AF00;">65,792</span> │</span></span>
<span><span class="co">## ├─────────────────────────────────┼────────────────────────┼───────────────┤</span></span>
<span><span class="co">## │ dropout (<span style="color: #0087FF;">Dropout</span>)               │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">256</span>)            │             <span style="color: #00AF00;">0</span> │</span></span>
<span><span class="co">## ├─────────────────────────────────┼────────────────────────┼───────────────┤</span></span>
<span><span class="co">## │ dense_2 (<span style="color: #0087FF;">Dense</span>)                 │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">256</span>)            │        <span style="color: #00AF00;">65,792</span> │</span></span>
<span><span class="co">## ├─────────────────────────────────┼────────────────────────┼───────────────┤</span></span>
<span><span class="co">## │ dropout_1 (<span style="color: #0087FF;">Dropout</span>)             │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">256</span>)            │             <span style="color: #00AF00;">0</span> │</span></span>
<span><span class="co">## ├─────────────────────────────────┼────────────────────────┼───────────────┤</span></span>
<span><span class="co">## │ dense_3 (<span style="color: #0087FF;">Dense</span>)                 │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">1</span>)              │           <span style="color: #00AF00;">257</span> │</span></span>
<span><span class="co">## └─────────────────────────────────┴────────────────────────┴───────────────┘</span></span>
<span><span class="co">## <span style="font-weight: bold;"> Total params: </span><span style="color: #00AF00;">139,777</span> (546.00 KB)</span></span>
<span><span class="co">## <span style="font-weight: bold;"> Trainable params: </span><span style="color: #00AF00;">139,777</span> (546.00 KB)</span></span>
<span><span class="co">## <span style="font-weight: bold;"> Non-trainable params: </span><span style="color: #00AF00;">0</span> (0.00 B)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="train-the-model-with-class_weight-argument">Train the model with <code>class_weight</code> argument<a class="anchor" aria-label="anchor" href="#train-the-model-with-class_weight-argument"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../../../reference/metric_false_negatives.html">metric_false_negatives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"fn"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../../reference/metric_false_positives.html">metric_false_positives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"fp"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../../reference/metric_true_negatives.html">metric_true_negatives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"tn"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../../reference/metric_true_positives.html">metric_true_positives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"tp"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../../reference/metric_precision.html">metric_precision</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"precision"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../../reference/metric_recall.html">metric_recall</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"recall"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span></span>
<span>  optimizer <span class="op">=</span> <span class="fu"><a href="../../../reference/optimizer_adam.html">optimizer_adam</a></span><span class="op">(</span><span class="fl">1e-2</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"binary_crossentropy"</span>,</span>
<span>  metrics <span class="op">=</span> <span class="va">metrics</span></span>
<span><span class="op">)</span></span>
<span><span class="va">callbacks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../../../reference/callback_model_checkpoint.html">callback_model_checkpoint</a></span><span class="op">(</span><span class="st">"fraud_model_at_epoch_{epoch}.keras"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">class_weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="va">weight_for_0</span>,</span>
<span>                     <span class="st">"1"</span> <span class="op">=</span> <span class="va">weight_for_1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span></span>
<span>  <span class="va">train_features</span>, <span class="va">train_targets</span>,</span>
<span>  validation_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">val_features</span>, <span class="va">val_targets</span><span class="op">)</span>,</span>
<span>  class_weight <span class="op">=</span> <span class="va">class_weight</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">2048</span>,</span>
<span>  epochs <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  callbacks <span class="op">=</span> <span class="va">callbacks</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Epoch 1/30</span></span>
<span><span class="co">## 112/112 - 3s - 28ms/step - fn: 45.0000 - fp: 23707.0000 - loss: 2.2081e-06 - precision: 0.0144 - recall: 0.8849 - tn: 203748.0000 - tp: 346.0000 - val_fn: 9.0000 - val_fp: 2721.0000 - val_loss: 0.1728 - val_precision: 0.0327 - val_recall: 0.9109 - val_tn: 54139.0000 - val_tp: 92.0000</span></span>
<span><span class="co">## Epoch 2/30</span></span>
<span><span class="co">## 112/112 - 1s - 6ms/step - fn: 35.0000 - fp: 9264.0000 - loss: 1.6928e-06 - precision: 0.0370 - recall: 0.9105 - tn: 218191.0000 - tp: 356.0000 - val_fn: 9.0000 - val_fp: 1195.0000 - val_loss: 0.1100 - val_precision: 0.0715 - val_recall: 0.9109 - val_tn: 55665.0000 - val_tp: 92.0000</span></span>
<span><span class="co">## Epoch 3/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 28.0000 - fp: 8603.0000 - loss: 1.2127e-06 - precision: 0.0405 - recall: 0.9284 - tn: 218852.0000 - tp: 363.0000 - val_fn: 6.0000 - val_fp: 4727.0000 - val_loss: 0.2568 - val_precision: 0.0197 - val_recall: 0.9406 - val_tn: 52133.0000 - val_tp: 95.0000</span></span>
<span><span class="co">## Epoch 4/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 25.0000 - fp: 6697.0000 - loss: 1.0623e-06 - precision: 0.0518 - recall: 0.9361 - tn: 220758.0000 - tp: 366.0000 - val_fn: 12.0000 - val_fp: 1079.0000 - val_loss: 0.0645 - val_precision: 0.0762 - val_recall: 0.8812 - val_tn: 55781.0000 - val_tp: 89.0000</span></span>
<span><span class="co">## Epoch 5/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 25.0000 - fp: 6461.0000 - loss: 9.4882e-07 - precision: 0.0536 - recall: 0.9361 - tn: 220994.0000 - tp: 366.0000 - val_fn: 8.0000 - val_fp: 2180.0000 - val_loss: 0.1322 - val_precision: 0.0409 - val_recall: 0.9208 - val_tn: 54680.0000 - val_tp: 93.0000</span></span>
<span><span class="co">## Epoch 6/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 14.0000 - fp: 6436.0000 - loss: 7.0306e-07 - precision: 0.0553 - recall: 0.9642 - tn: 221019.0000 - tp: 377.0000 - val_fn: 12.0000 - val_fp: 927.0000 - val_loss: 0.0489 - val_precision: 0.0876 - val_recall: 0.8812 - val_tn: 55933.0000 - val_tp: 89.0000</span></span>
<span><span class="co">## Epoch 7/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 20.0000 - fp: 8652.0000 - loss: 9.5322e-07 - precision: 0.0411 - recall: 0.9488 - tn: 218803.0000 - tp: 371.0000 - val_fn: 9.0000 - val_fp: 1213.0000 - val_loss: 0.0587 - val_precision: 0.0705 - val_recall: 0.9109 - val_tn: 55647.0000 - val_tp: 92.0000</span></span>
<span><span class="co">## Epoch 8/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 16.0000 - fp: 8275.0000 - loss: 8.6911e-07 - precision: 0.0434 - recall: 0.9591 - tn: 219180.0000 - tp: 375.0000 - val_fn: 13.0000 - val_fp: 771.0000 - val_loss: 0.0680 - val_precision: 0.1024 - val_recall: 0.8713 - val_tn: 56089.0000 - val_tp: 88.0000</span></span>
<span><span class="co">## Epoch 9/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 11.0000 - fp: 5889.0000 - loss: 6.6022e-07 - precision: 0.0606 - recall: 0.9719 - tn: 221566.0000 - tp: 380.0000 - val_fn: 9.0000 - val_fp: 564.0000 - val_loss: 0.0321 - val_precision: 0.1402 - val_recall: 0.9109 - val_tn: 56296.0000 - val_tp: 92.0000</span></span>
<span><span class="co">## Epoch 10/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 9.0000 - fp: 5360.0000 - loss: 4.7577e-07 - precision: 0.0665 - recall: 0.9770 - tn: 222095.0000 - tp: 382.0000 - val_fn: 8.0000 - val_fp: 1314.0000 - val_loss: 0.0550 - val_precision: 0.0661 - val_recall: 0.9208 - val_tn: 55546.0000 - val_tp: 93.0000</span></span>
<span><span class="co">## Epoch 11/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 20.0000 - fp: 9677.0000 - loss: 1.0933e-06 - precision: 0.0369 - recall: 0.9488 - tn: 217778.0000 - tp: 371.0000 - val_fn: 10.0000 - val_fp: 1706.0000 - val_loss: 0.0974 - val_precision: 0.0506 - val_recall: 0.9010 - val_tn: 55154.0000 - val_tp: 91.0000</span></span>
<span><span class="co">## Epoch 12/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 9.0000 - fp: 5843.0000 - loss: 5.5728e-07 - precision: 0.0614 - recall: 0.9770 - tn: 221612.0000 - tp: 382.0000 - val_fn: 7.0000 - val_fp: 2226.0000 - val_loss: 0.1175 - val_precision: 0.0405 - val_recall: 0.9307 - val_tn: 54634.0000 - val_tp: 94.0000</span></span>
<span><span class="co">## Epoch 13/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 12.0000 - fp: 8078.0000 - loss: 8.7332e-07 - precision: 0.0448 - recall: 0.9693 - tn: 219377.0000 - tp: 379.0000 - val_fn: 8.0000 - val_fp: 2571.0000 - val_loss: 0.0926 - val_precision: 0.0349 - val_recall: 0.9208 - val_tn: 54289.0000 - val_tp: 93.0000</span></span>
<span><span class="co">## Epoch 14/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 9.0000 - fp: 6035.0000 - loss: 5.1023e-07 - precision: 0.0595 - recall: 0.9770 - tn: 221420.0000 - tp: 382.0000 - val_fn: 9.0000 - val_fp: 998.0000 - val_loss: 0.0420 - val_precision: 0.0844 - val_recall: 0.9109 - val_tn: 55862.0000 - val_tp: 92.0000</span></span>
<span><span class="co">## Epoch 15/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 4.0000 - fp: 4814.0000 - loss: 4.2882e-07 - precision: 0.0744 - recall: 0.9898 - tn: 222641.0000 - tp: 387.0000 - val_fn: 7.0000 - val_fp: 2388.0000 - val_loss: 0.2131 - val_precision: 0.0379 - val_recall: 0.9307 - val_tn: 54472.0000 - val_tp: 94.0000</span></span>
<span><span class="co">## Epoch 16/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 14.0000 - fp: 6866.0000 - loss: 6.4459e-07 - precision: 0.0521 - recall: 0.9642 - tn: 220589.0000 - tp: 377.0000 - val_fn: 8.0000 - val_fp: 1106.0000 - val_loss: 0.0472 - val_precision: 0.0776 - val_recall: 0.9208 - val_tn: 55754.0000 - val_tp: 93.0000</span></span>
<span><span class="co">## Epoch 17/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 8.0000 - fp: 7243.0000 - loss: 5.1227e-07 - precision: 0.0502 - recall: 0.9795 - tn: 220212.0000 - tp: 383.0000 - val_fn: 8.0000 - val_fp: 1185.0000 - val_loss: 0.0483 - val_precision: 0.0728 - val_recall: 0.9208 - val_tn: 55675.0000 - val_tp: 93.0000</span></span>
<span><span class="co">## Epoch 18/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 4.0000 - fp: 3529.0000 - loss: 3.2284e-07 - precision: 0.0988 - recall: 0.9898 - tn: 223926.0000 - tp: 387.0000 - val_fn: 8.0000 - val_fp: 1655.0000 - val_loss: 0.0717 - val_precision: 0.0532 - val_recall: 0.9208 - val_tn: 55205.0000 - val_tp: 93.0000</span></span>
<span><span class="co">## Epoch 19/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 2.0000 - fp: 4189.0000 - loss: 3.3201e-07 - precision: 0.0850 - recall: 0.9949 - tn: 223266.0000 - tp: 389.0000 - val_fn: 10.0000 - val_fp: 775.0000 - val_loss: 0.0351 - val_precision: 0.1051 - val_recall: 0.9010 - val_tn: 56085.0000 - val_tp: 91.0000</span></span>
<span><span class="co">## Epoch 20/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 3.0000 - fp: 3593.0000 - loss: 4.7423e-07 - precision: 0.0975 - recall: 0.9923 - tn: 223862.0000 - tp: 388.0000 - val_fn: 9.0000 - val_fp: 982.0000 - val_loss: 0.0459 - val_precision: 0.0857 - val_recall: 0.9109 - val_tn: 55878.0000 - val_tp: 92.0000</span></span>
<span><span class="co">## Epoch 21/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 4.0000 - fp: 4057.0000 - loss: 5.4189e-07 - precision: 0.0871 - recall: 0.9898 - tn: 223398.0000 - tp: 387.0000 - val_fn: 12.0000 - val_fp: 603.0000 - val_loss: 0.0544 - val_precision: 0.1286 - val_recall: 0.8812 - val_tn: 56257.0000 - val_tp: 89.0000</span></span>
<span><span class="co">## Epoch 22/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 4.0000 - fp: 4709.0000 - loss: 5.5967e-07 - precision: 0.0759 - recall: 0.9898 - tn: 222746.0000 - tp: 387.0000 - val_fn: 8.0000 - val_fp: 1645.0000 - val_loss: 0.0862 - val_precision: 0.0535 - val_recall: 0.9208 - val_tn: 55215.0000 - val_tp: 93.0000</span></span>
<span><span class="co">## Epoch 23/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 13.0000 - fp: 7337.0000 - loss: 9.8862e-07 - precision: 0.0490 - recall: 0.9668 - tn: 220118.0000 - tp: 378.0000 - val_fn: 11.0000 - val_fp: 683.0000 - val_loss: 0.0500 - val_precision: 0.1164 - val_recall: 0.8911 - val_tn: 56177.0000 - val_tp: 90.0000</span></span>
<span><span class="co">## Epoch 24/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 8.0000 - fp: 4145.0000 - loss: 5.6664e-07 - precision: 0.0846 - recall: 0.9795 - tn: 223310.0000 - tp: 383.0000 - val_fn: 9.0000 - val_fp: 3412.0000 - val_loss: 0.1944 - val_precision: 0.0263 - val_recall: 0.9109 - val_tn: 53448.0000 - val_tp: 92.0000</span></span>
<span><span class="co">## Epoch 25/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 2.0000 - fp: 4869.0000 - loss: 4.9343e-07 - precision: 0.0740 - recall: 0.9949 - tn: 222586.0000 - tp: 389.0000 - val_fn: 10.0000 - val_fp: 879.0000 - val_loss: 0.0453 - val_precision: 0.0938 - val_recall: 0.9010 - val_tn: 55981.0000 - val_tp: 91.0000</span></span>
<span><span class="co">## Epoch 26/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 5.0000 - fp: 3203.0000 - loss: 3.2283e-07 - precision: 0.1076 - recall: 0.9872 - tn: 224252.0000 - tp: 386.0000 - val_fn: 9.0000 - val_fp: 1163.0000 - val_loss: 0.0681 - val_precision: 0.0733 - val_recall: 0.9109 - val_tn: 55697.0000 - val_tp: 92.0000</span></span>
<span><span class="co">## Epoch 27/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 3.0000 - fp: 3169.0000 - loss: 3.0544e-07 - precision: 0.1091 - recall: 0.9923 - tn: 224286.0000 - tp: 388.0000 - val_fn: 9.0000 - val_fp: 1845.0000 - val_loss: 0.0807 - val_precision: 0.0475 - val_recall: 0.9109 - val_tn: 55015.0000 - val_tp: 92.0000</span></span>
<span><span class="co">## Epoch 28/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 2.0000 - fp: 3077.0000 - loss: 2.6160e-07 - precision: 0.1122 - recall: 0.9949 - tn: 224378.0000 - tp: 389.0000 - val_fn: 12.0000 - val_fp: 275.0000 - val_loss: 0.0220 - val_precision: 0.2445 - val_recall: 0.8812 - val_tn: 56585.0000 - val_tp: 89.0000</span></span>
<span><span class="co">## Epoch 29/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 2.0000 - fp: 2628.0000 - loss: 2.5775e-07 - precision: 0.1289 - recall: 0.9949 - tn: 224827.0000 - tp: 389.0000 - val_fn: 13.0000 - val_fp: 1013.0000 - val_loss: 0.0520 - val_precision: 0.0799 - val_recall: 0.8713 - val_tn: 55847.0000 - val_tp: 88.0000</span></span>
<span><span class="co">## Epoch 30/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 2.0000 - fp: 4318.0000 - loss: 4.4087e-07 - precision: 0.0826 - recall: 0.9949 - tn: 223137.0000 - tp: 389.0000 - val_fn: 11.0000 - val_fp: 903.0000 - val_loss: 0.0561 - val_precision: 0.0906 - val_recall: 0.8911 - val_tn: 55957.0000 - val_tp: 90.0000</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">val_pred</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op"><a href="../../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">val_features</span><span class="op">)</span> <span class="op"><a href="../../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">.</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## 1781/1781 - 1s - 424us/step</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_correct</span> <span class="op">&lt;-</span> <span class="va">val_df</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="va">val_pred</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Validation accuracy: %.2f"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred_correct</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Validation accuracy: 0.98</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fraudulent</span> <span class="op">&lt;-</span> <span class="va">val_df</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">n_fraudulent_detected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fraudulent</span> <span class="op">&amp;</span> <span class="va">pred_correct</span><span class="op">)</span></span>
<span><span class="va">n_fraudulent_missed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fraudulent</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">pred_correct</span><span class="op">)</span></span>
<span><span class="va">n_legitimate_flagged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">fraudulent</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">pred_correct</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>At the end of training, out of 56,961 validation transactions, we
are:</p>
<ul>
<li>Correctly identifying 90 of them as fraudulent</li>
<li>Missing 11 fraudulent transactions</li>
<li>At the cost of incorrectly flagging 903 legitimate transactions</li>
</ul>
<p>In the real world, one would put an even higher weight on class 1, so
as to reflect that False Negatives are more costly than False
Positives.</p>
<p>Next time your credit card gets declined in an online purchase – this
is why.</p>
<!-- | Trained Model                                                                                                                                                          | Demo                                                                                                                                                                             | -->
<!-- |------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| -->
<!-- | [![Generic badge](https://img.shields.io/badge/%F0%9F%A4%97%20Model-Imbalanced%20Classification-black.svg)](https://huggingface.co/keras-io/imbalanced_classification) | [![Generic badge](https://img.shields.io/badge/%F0%9F%A4%97%20Spaces-Imbalanced%20Classification-black.svg)](https://huggingface.co/spaces/keras-io/Credit_Card_Fraud_Detection) | -->
<!-- : Example available on HuggingFace. -->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tomasz Kalinowski, JJ Allaire, François Chollet, Posit Software, PBC, Google.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
